// Teacher Time - Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
class TeacherTimeApp {
    constructor() {
        this.timer = null;
        this.timeLeft = 25 * 60; // 25 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
        this.isRunning = false;
        this.sessions = 0;
        this.tasks = JSON.parse(localStorage.getItem('teacherTimeTasks')) || [];
        this.stats = JSON.parse(localStorage.getItem('teacherTimeStats')) || {
            sessions: 0,
            completedTasks: 0
        };

        this.initializeApp();
        this.bindEvents();
        this.updateDisplay();
        this.renderTasks();
        this.updateStats();
    }

    initializeApp() {
        console.log('ðŸš€ Teacher Time App Initialized');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… PWA
        if ('serviceWorker' in navigator) {
            console.log('âœ… Service Worker supported');
        }
        
        if ('Notification' in window) {
            this.requestNotificationPermission();
        }
    }

    bindEvents() {
        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø¤Ù‚Øª
        document.getElementById('startBtn').addEventListener('click', () => this.startTimer());
        document.getElementById('pauseBtn').addEventListener('click', () => this.pauseTimer());
        document.getElementById('resetBtn').addEventListener('click', () => this.resetTimer());

        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù‡Ø§Ù…
        document.getElementById('addTaskBtn').addEventListener('click', () => this.addTask());
        document.getElementById('taskInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.addTask();
        });

        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«
        window.addEventListener('online', this.handleOnlineStatus.bind(this));
        window.addEventListener('offline', this.handleOfflineStatus.bind(this));
    }

    startTimer() {
        if (!this.isRunning) {
            this.isRunning = true;
            this.timer = setInterval(() => {
                this.timeLeft--;
                this.updateDisplay();

                if (this.timeLeft <= 0) {
                    this.completeSession();
                }
            }, 1000);

            this.showNotification('Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©', 'ØªÙ… Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
            document.getElementById('startBtn').disabled = true;
        }
    }

    pauseTimer() {
        if (this.isRunning) {
            this.isRunning = false;
            clearInterval(this.timer);
            document.getElementById('startBtn').disabled = false;
            this.showNotification('Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª', 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ù…Ø¤Ù‚ØªØ§Ù‹');
        }
    }

    resetTimer() {
        this.isRunning = false;
        clearInterval(this.timer);
        this.timeLeft = 25 * 60;
        this.updateDisplay();
        document.getElementById('startBtn').disabled = false;
    }

    completeSession() {
        this.isRunning = false;
        clearInterval(this.timer);
        this.sessions++;
        this.stats.sessions++;
        
        this.showNotification('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©', 'Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ø±Ø§Ø­Ø©! ðŸŽ‰', true);
        this.updateStats();
        this.saveToStorage();
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ø¥Ø°Ø§ Ù…ØªØ§Ø­
        if (navigator.vibrate) {
            navigator.vibrate([200, 100, 200]);
        }
    }

    updateDisplay() {
        const minutes = Math.floor(this.timeLeft / 60);
        const seconds = this.timeLeft % 60;
        const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        document.getElementById('timerDisplay').textContent = display;
        
        // ØªØ­Ø¯ÙŠØ« title tag
        document.title = `(${display}) Teacher Time`;
    }

    addTask() {
        const taskInput = document.getElementById('taskInput');
        const text = taskInput.value.trim();

        if (text) {
            const task = {
                id: Date.now(),
                text: text,
                completed: false,
                createdAt: new Date().toISOString()
            };

            this.tasks.push(task);
            this.renderTasks();
            this.saveToStorage();
            taskInput.value = '';
            
            this.showNotification('Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©', `ØªÙ… Ø¥Ø¶Ø§ÙØ©: ${text}`);
        }
    }

    toggleTask(id) {
        const task = this.tasks.find(t => t.id === id);
        if (task) {
            task.completed = !task.completed;
            if (task.completed) {
                this.stats.completedTasks++;
            }
            this.renderTasks();
            this.updateStats();
            this.saveToStorage();
        }
    }

    deleteTask(id) {
        this.tasks = this.tasks.filter(t => t.id !== id);
        this.renderTasks();
        this.saveToStorage();
    }

    renderTasks() {
        const tasksList = document.getElementById('tasksList');
        tasksList.innerHTML = '';

        this.tasks.forEach(task => {
            const li = document.createElement('li');
            li.className = 'task-item';
            
            li.innerHTML = `
                <div class="task-checkbox ${task.completed ? 'checked' : ''}" 
                     onclick="app.toggleTask(${task.id})">
                    ${task.completed ? 'âœ“' : ''}
                </div>
                <span class="task-text ${task.completed ? 'completed' : ''}">${task.text}</span>
                <button class="task-delete" onclick="app.deleteTask(${task.id})">Ã—</button>
            `;
            
            tasksList.appendChild(li);
        });

        document.getElementById('tasksCount').textContent = this.stats.completedTasks;
    }

    updateStats() {
        document.getElementById('sessionsCount').textContent = this.stats.sessions;
        document.getElementById('tasksCount').textContent = this.stats.completedTasks;
    }

    saveToStorage() {
        localStorage.setItem('teacherTimeTasks', JSON.stringify(this.tasks));
        localStorage.setItem('teacherTimeStats', JSON.stringify(this.stats));
    }

    showNotification(title, message, isImportant = false) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = `notification ${isImportant ? 'success' : ''}`;
        
        // Ø¥Ø²Ø§Ù„Ø© class Ø§Ù„Ù…Ø®ÙÙŠ
        notification.classList.remove('hidden');
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
            notification.classList.add('hidden');
        }, 3000);
    }

    async requestNotificationPermission() {
        if ('Notification' in window && Notification.permission === 'default') {
            try {
                await Notification.requestPermission();
            } catch (error) {
                console.log('âŒ Error requesting notification permission:', error);
            }
        }
    }

    handleOnlineStatus() {
        this.showNotification('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„', 'Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†', true);
        console.log('âœ… App is online');
    }

    handleOfflineStatus() {
        this.showNotification('ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„', 'Ø£Ù†Øª ØªØ¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„', false);
        console.log('âš ï¸ App is offline');
    }

    // Ø¯Ø§Ù„Ø© Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… (ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    async syncWithServer() {
        if (navigator.onLine) {
            try {
                // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…
                console.log('ðŸ”„ Syncing with server...');
            } catch (error) {
                console.error('âŒ Sync failed:', error);
            }
        }
    }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
let app;
document.addEventListener('DOMContentLoaded', () => {
    app = new TeacherTimeApp();
});

// Ø¯Ø¹Ù… ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„
window.addEventListener('load', () => {
    if (!navigator.onLine) {
        document.body.classList.add('offline');
    }
});